---
- hosts: all

  tasks:

    - name: install deps
      apt:
        name={{ item }}
        state=present
      with_items:
        - git
        - ansible
        - python3-dev
        - python-virtualenv
        - libxml2-dev
        - libxslt1-dev
        - zlib1g-dev
        - lftp
        - pandoc
        - nodejs
        - nodejs-legacy
        - npm
        - mc
      sudo: yes

    - name: clone batcave
      git:
        repo=https://github.com/xsteadfastx/batcave.git
        dest=~/batcave

    - name: run batcave
      command:
        ansible-playbook -i hosts site.yml --skip-tags "x11" -c local
        chdir=~/batcave

    - name: create python environment and install packages
      pip:
        name={{ item }}
        virtualenv=~/env
        virtualenv_command="virtualenv -p /usr/bin/python3"
      with_items:
        - pelican
        - markdown
        - ipython[notebook]==2.4.1
        - cookiecutter

    - name: clone pelican-plugins
      git:
        repo=https://github.com/getpelican/pelican-plugins.git
        dest=/vagrant/pelican-plugins

    - name: export PYTHONIOENCODING to UTF-8
      lineinfile:
        dest=~/.zshrc
        line="export PYTHONIOENCODING=UTF-8"

    - name: install bower
      npm:
        name=bower
        global=yes
        state=present
      sudo: yes
